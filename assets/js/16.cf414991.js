(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{342:function(t,s,a){"use strict";a.r(s);var n=a(33),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"vue-router如何实现拦截物理返回键的回退功能"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#vue-router如何实现拦截物理返回键的回退功能"}},[t._v("#")]),t._v(" Vue-router如何实现拦截物理返回键的回退功能")]),t._v(" "),a("h1",{attrs:{id:"浏览器拦截"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#浏览器拦截"}},[t._v("#")]),t._v(" 浏览器拦截")]),t._v(" "),a("p",[t._v("拦截物理键，原则上是监听popstate事件，然而，现实很残酷，因为popstate事件的意思是路由已经变化完成，也就是说，并没有一种方法真正监听物理键的点击。一旦触发popstate，其实就已经晚了，因为路由已经变化了，你已经无法拦截。")]),t._v(" "),a("p",[t._v("因此，"),a("code",[t._v('window.addEventListener("popstate", fn)')]),t._v("的回调函数fn，是在浏览器回退之后执行，这个回退是浏览器自己执行的，不受任何控制，无论是加上"),a("code",[t._v("event.preventDefault()")]),t._v("还是"),a("code",[t._v("return false")]),t._v("都白扯。这就好比，一个元素已经监听到了click，你无论加什么代码，都不能让浏览器当做没有点击（CSS层面的阻止点击另说）。")]),t._v(" "),a("p",[t._v("怎么办？")]),t._v(" "),a("p",[t._v("只能是给浏览器跪下，先听从它回退，然后再重新push回来。好在，Vue-router给我们提供了push回来的方法。")]),t._v(" "),a("p",[t._v("好了，我们开始。")]),t._v(" "),a("h1",{attrs:{id:"方法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#方法"}},[t._v("#")]),t._v(" 方法")]),t._v(" "),a("p",[t._v("在需要的组件（必须是路由级组件）里加入：")]),t._v(" "),a("div",{staticClass:"language-kotlin extra-class"},[a("pre",{pre:!0,attrs:{class:"language-kotlin"}},[a("code",[t._v("  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("beforeRouteLeave")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("to")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" from"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" next"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 仅适用于本页面不作为H5着陆页的情况")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("skuShow"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("$store"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("commit")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'SET_SKU_SHOW'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("next")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("next")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n")])])]),a("p",[t._v("核心代码是"),a("code",[t._v("next(false)")]),t._v("。根据官方说法：")]),t._v(" "),a("blockquote",[a("p",[t._v("如果浏览器的 URL 改变了 (可能是用户手动或者浏览器后退按钮)，那么 URL 地址会重置到 from 路由对应的地址。")])]),t._v(" "),a("p",[t._v("所以其实也是push回来的道理。")])])}),[],!1,null,null,null);s.default=e.exports}}]);